<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Acceso - AereoSky</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/services/auth.js" defer></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Poppins", sans-serif;
      }
    </style>
  </head>

  <body class="bg-gray-100">
    <!-- NAVBAR (copiado de home.html) -->
    <nav class="bg-white shadow-lg fixed w-full z-10">
      <div class="container mx-auto px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <svg
              class="h-8 w-8 text-blue-600 mr-2"
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
              />
            </svg>
            <a
              href="../../index.html"
              class="text-2xl font-bold text-gray-800"
              >AereoSky</a
            >
          </div>

          <div class="hidden md:flex items-center space-x-6">
            <a
              href="../../index.html"
              class="text-gray-600 hover:text-blue-600 transition duration-300"
              >Home</a
            >

            <a
              href="/views/consulta-vuelos.html"
              class="text-gray-600 hover:text-blue-600 transition duration-300"
              >Vuelos</a
            >

            <!-- Mis Reservas (visible solo si está logueado) -->
            <a
              href="/views/mis-reservas.html"
              id="nav-mis-reservas"
              class="hidden text-gray-600 hover:text-blue-600 transition duration-300"
              >Mis Reservas</a
            >

            <a
              href="/views/contacto.html"
              class="text-gray-600 hover:text-blue-600 transition duration-300"
              >Contacto</a
            >

            <div id="admin-panel" class="hidden relative">
              <button
                id="admin-panel-button"
                class="flex items-center text-gray-600 font-semibold hover:text-blue-600 p-2 rounded-lg bg-gray-100 hover:bg-gray-200 transition"
              >
                <span>Administración</span>
                <svg
                  class="h-5 w-5 ml-1"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 20 20"
                  fill="currentColor"
                >
                  <path
                    fill-rule="evenodd"
                    d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                    clip-rule="evenodd"
                  />
                </svg>
              </button>
              <div
                id="admin-panel-menu"
                class="hidden absolute right-0 mt-2 w-48 bg-white rounded-md shadow-xl z-20"
              >
                <a
                  href="/views/aviones.html"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >Aviones</a
                >
                <a
                  href="/views/aerolineas.html"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >Aerolineas</a
                >
                <a
                  href="/views/fabricantes.html"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >Fabricantes</a
                >
                <a
                  href="/views/usuarios.html"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >Usuarios</a
                >
                <a
                  href="/views/reservas.html"
                  class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
                  >Reservas</a
                >
              </div>
            </div>
          </div>

          <a
            href="/views/login.html"
            id="login-button"
            class="bg-blue-600 text-white px-5 py-2 rounded-lg hover:bg-blue-700 transition duration-300 shadow"
          >
            Iniciar Sesión
          </a>

          <div id="user-menu" class="hidden items-center space-x-4">
            <a
              href="/views/perfil.html"
              class="text-gray-600 hover:text-blue-600 font-medium"
              >Mi Perfil</a
            >
            <button
              id="logout-button"
              class="bg-red-600 text-white px-5 py-2 rounded-lg hover:bg-red-600 transition duration-300 shadow"
            >
              Cerrar Sesión
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- CONTENIDO LOGIN / REGISTER (SIN CAMBIOS DE LÓGICA) -->
    <div class="flex items-center justify-center min-h-screen pt-20">
      <div
        class="flex w-full max-w-7xl mx-auto shadow-2xl rounded-2xl overflow-hidden"
      >
        <div
          class="flex flex-col justify-center w-full md:w-1/2 p-8 md:p-14 bg-white"
        >
          <!-- LOGIN -->
          <div id="login-form">
            <div class="flex items-center mb-8">
              <svg
                class="h-8 w-8 text-blue-600 mr-2"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                />
              </svg>
              <span class="text-2xl font-bold text-gray-800">AereoSky</span>
            </div>

            <span class="mb-3 text-4xl font-bold">Bienvenido de Nuevo</span>
            <span class="font-light text-gray-500 mb-8 block"
              >Inicia sesión para continuar tu viaje.</span
            >

            <form id="loginFormEl" class="flex flex-col space-y-5">
              <div>
                <label
                  for="login-email"
                  class="text-sm font-medium text-gray-700"
                  >Correo Electrónico</label
                >
                <input
                  type="email"
                  id="login-email"
                  placeholder="tu.email@ejemplo.com"
                  class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div>
                <label
                  for="login-password"
                  class="text-sm font-medium text-gray-700"
                  >Contraseña</label
                >
                <input
                  type="password"
                  id="login-password"
                  placeholder="Ingresa tu contraseña"
                  class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div class="text-right">
                <a
                  href="#"
                  id="forgot-password-link"
                  class="text-sm font-medium text-blue-600 hover:underline"
                  >¿Olvidaste tu contraseña?</a
                >
              </div>

              <button
                type="submit"
                class="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md"
              >
                Iniciar Sesión
              </button>
            </form>

            <div class="mt-8 text-center text-gray-600">
              <p>
                ¿No tienes una cuenta?
                <a
                  href="#"
                  id="show-register-link"
                  class="font-semibold text-blue-600 hover:underline"
                  >Regístrate aquí</a
                >
              </p>
            </div>
          </div>

          <!-- REGISTER -->
          <div id="register-container" class="hidden">
            <div class="flex items-center mb-8">
              <svg
                class="h-8 w-8 text-blue-600 mr-2"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"
                />
              </svg>
              <span class="text-2xl font-bold text-gray-800">AereoSky</span>
            </div>

            <span class="mb-3 text-4xl font-bold">Crea tu Cuenta</span>
            <span class="font-light text-gray-500 mb-8 block"
              >Únete y empieza a explorar el mundo.</span
            >

            <form id="registerForm" class="flex flex-col space-y-4">
              <div class="flex flex-col md:flex-row md:space-x-4">
                <div class="w-full md:w-1/2">
                  <label for="nombres" class="text-sm font-medium text-gray-700"
                    >Nombres</label
                  >
                  <input
                    type="text"
                    id="nombres"
                    placeholder="Primer y segundo nombre"
                    class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>

                <div class="w-full md:w-1/2 mt-4 md:mt-0">
                  <label
                    for="apellidos"
                    class="text-sm font-medium text-gray-700"
                    >Apellidos</label
                  >
                  <input
                    type="text"
                    id="apellidos"
                    placeholder="Primer y segundo apellido"
                    class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>

              <div class="flex flex-col md:flex-row md:space-x-4">
                <div class="w-full md:w-1/2">
                  <label for="cedula" class="text-sm font-medium text-gray-700"
                    >Cédula</label
                  >
                  <input
                    type="text"
                    id="cedula"
                    placeholder="0123456789"
                    class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>

                <div class="w-full md:w-1/2 mt-4 md:mt-0">
                  <label
                    for="register-email"
                    class="text-sm font-medium text-gray-700"
                    >Correo Electrónico</label
                  >
                  <input
                    type="email"
                    id="register-email"
                    placeholder="tu.email@ejemplo.com"
                    class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                  />
                </div>
              </div>

              <div>
                <label
                  for="register-password"
                  class="text-sm font-medium text-gray-700"
                  >Contraseña</label
                >
                <input
                  type="password"
                  id="register-password"
                  placeholder="Crea una contraseña segura"
                  class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div>
                <label for="telefono" class="text-sm font-medium text-gray-700"
                  >Teléfono</label
                >
                <input
                  type="tel"
                  id="telefono"
                  placeholder="0987654321"
                  class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <div>
                <label
                  for="direccion"
                  class="text-sm font-medium text-gray-700"
                  >Dirección</label
                >
                <input
                  type="text"
                  id="direccion"
                  placeholder="Calle Principal 123"
                  class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                />
              </div>

              <button
                type="submit"
                class="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md"
              >
                Crear Cuenta
              </button>
            </form>

            <div class="mt-8 text-center text-gray-600">
              <p>
                ¿Ya tienes una cuenta?
                <a
                  href="#"
                  id="show-login-link"
                  class="font-semibold text-blue-600 hover:underline"
                  >Inicia sesión</a
                >
              </p>
            </div>
          </div>
        </div>

        <div class="hidden md:block md:w-1/2 relative">
          <img
            src="https://images.stockcake.com/public/f/b/6/fb6acf1b-fcaa-4152-b48b-6b0e2b0c5374_large/airplane-mid-flight-stockcake.jpg"
            alt="Imagen de viajes"
            class="w-full h-full object-cover"
          />
          <div
            class="absolute bottom-10 left-10 text-white p-4 bg-black bg-opacity-50 rounded-lg"
          >
            <h2 class="text-2xl font-bold">El mundo te espera.</h2>
            <p class="text-gray-200">
              Millones de destinos a un solo clic de distancia.
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- MODAL RECUPERAR CONTRASEÑA -->
    <div
      id="forgot-password-modal"
      class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    >
      <div class="bg-white p-8 rounded-2xl shadow-xl w-full max-w-md relative">
        <button
          id="close-modal-button"
          class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition"
        >
          <svg
            class="h-6 w-6"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"
            />
          </svg>
        </button>

        <h2 class="text-2xl font-bold text-gray-800 mb-2">
          Recuperar Contraseña
        </h2>
        <p class="text-gray-600 mb-6">
          Ingresa tu correo electrónico y te enviaremos las instrucciones para
          restablecer tu contraseña.
        </p>

        <form id="forgot-password-form">
          <div>
            <label
              for="recovery-email"
              class="text-sm font-medium text-gray-700"
              >Correo Electrónico</label
            >
            <input
              type="email"
              id="recovery-email"
              required
              placeholder="tu.email@ejemplo.com"
              class="w-full mt-2 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div class="mt-6">
            <button
              type="submit"
              class="w-full bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 transition duration-300 shadow-md"
            >
              Enviar Correo de Recuperación
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- FOOTER (copiado de home.html) -->
    <footer class="bg-gray-800 text-white py-10">
      <div class="container mx-auto px-6">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <h4 class="text-lg font-semibold mb-4">AereoSky</h4>
            <p class="text-gray-400">
              Tu compañero de viaje ideal. Hacemos que la reserva de vuelos sea
              simple, rápida y asequible.
            </p>
          </div>

          <div>
            <h4 class="text-lg font-semibold mb-4">Enlaces Rápidos</h4>
            <ul class="space-y-2 text-gray-400" id="footer-links">
              <li>
                <a
                  href="../../index.html"
                  class="hover:text-white"
                  >Home</a
                >
              </li>
              <li>
                <a
                  href="/views/consulta-vuelos.html"
                  class="hover:text-white"
                  >Vuelos</a
                >
              </li>
              <!-- Mis Reservas (solo autenticado) -->
              <li id="footer-mis-reservas" class="hidden">
                <a
                  href="/views/mis-reservas.html"
                  class="hover:text-white"
                  >Mis Reservas</a
                >
              </li>
              <li>
                <a
                  href="/views/contacto.html"
                  class="hover:text-white"
                  >Contacto</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h4 class="text-lg font-semibold mb-4">Contacto</h4>
            <ul class="space-y-2 text-gray-400">
              <li>Email: soporte@AereoSky.com</li>
              <li>Teléfono: +593 985 514 590</li>
              <li>Dirección: Machala, Ecuador</li>
            </ul>
          </div>

          <div>
            <h4 class="text-lg font-semibold mb-4">Síguenos</h4>
            <div class="flex space-x-4">
              <a href="#" class="text-gray-400 hover:text-white"
                ><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M22.46,6C21.69,6.35 20.86,6.58 20,6.69C20.88,6.16 21.56,5.32 21.88,4.31C21.05,4.81 20.13,5.16 19.16,5.36C18.37,4.5 17.26,4 16,4C13.65,4 11.73,5.92 11.73,8.29C11.73,8.63 11.77,8.96 11.84,9.28C8.28,9.09 5.11,7.38 2.9,4.79C2.53,5.42 2.33,6.16 2.33,6.94C2.33,8.43 3.08,9.75 4.18,10.53C3.49,10.51 2.82,10.31 2.22,10V10.06C2.22,12.23 3.78,14.05 5.9,14.45C5.55,14.54 5.18,14.59 4.8,14.59C4.54,14.59 4.28,14.56 4.03,14.51C4.6,16.28 6.26,17.56 8.24,17.6C6.68,18.81 4.77,19.53 2.72,19.53C2.38,19.53 2.05,19.51 1.72,19.46C3.72,20.78 6.11,21.56 8.75,21.56C16.01,21.56 20.24,15.71 20.24,10.65C20.24,10.46 20.24,10.27 20.23,10.08C21.02,9.49 21.8,8.78 22.46,7.92V6Z"
                  /></svg
              ></a>

              <a href="#" class="text-gray-400 hover:text-white"
                ><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.32 11.93 5.96 14.22 5.96C15.31 5.96 16.45 6.15 16.45 6.15V8.62H15.19C13.95 8.62 13.56 9.39 13.56 10.18V12.06H16.34L15.89 14.96H13.56V21.96C18.34 21.21 22 17.06 22 12.06C22 6.53 17.5 2.04 12 2.04Z"
                  /></svg
              ></a>

              <a href="#" class="text-gray-400 hover:text-white"
                ><svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                  <path
                    d="M7.8,2H16.2C19.4,2 22,4.6 22,7.8V16.2A5.8,5.8 0 0,1 16.2,22H7.8C4.6,22 2,19.4 2,16.2V7.8A5.8,5.8 0 0,1 7.8,2M7.6,4A3.6,3.6 0 0,0 4,7.6V16.4C4,18.39 5.61,20 7.6,20H16.4A3.6,3.6 0 0,0 20,16.4V7.6C20,5.61 18.39,4 16.4,4H7.6M17.25,5.5A1.25,1.25 0 0,1 18.5,6.75A1.25,1.25 0 0,1 17.25,8A1.25,1.25 0 0,1 16,6.75A1.25,1.25 0 0,1 17.25,5.5M12,7A5,5 0 0,1 17,12A5,5 0 0,1 12,17A5,5 0 0,1 7,12A5,5 0 0,1 12,7Z"
                  /></svg
              ></a>
            </div>
          </div>
        </div>

        <div
          class="mt-8 border-t border-gray-700 pt-6 text-center text-gray-500"
        >
          <p>&copy; 2025 AereoSky. Todos los derechos reservados.</p>
        </div>
      </div>
    </footer>

    <!-- SCRIPT DE LA PÁGINA (login/register/recuperar) -->
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const loginForm = document.getElementById("login-form");
        const registerForm = document.getElementById("register-container");
        const showRegisterLink = document.getElementById("show-register-link");
        const showLoginLink = document.getElementById("show-login-link");

        const forgotPasswordModal = document.getElementById(
          "forgot-password-modal"
        );
        const forgotPasswordLink = document.getElementById(
          "forgot-password-link"
        );
        const closeModalButton = document.getElementById("close-modal-button");
        const forgotPasswordForm = document.getElementById(
          "forgot-password-form"
        );

        // cambiar a registro
        showRegisterLink.addEventListener("click", (event) => {
          event.preventDefault();
          loginForm.classList.add("hidden");
          registerForm.classList.remove("hidden");
        });

        // volver a login
        showLoginLink.addEventListener("click", (event) => {
          event.preventDefault();
          registerForm.classList.add("hidden");
          loginForm.classList.remove("hidden");
        });

        // REGISTRO
        const registerFormEl = document.getElementById("registerForm");

        if (!registerFormEl) {
          console.warn(
            "No se encontró el formulario #registerForm. Verifica que el form tenga id='registerForm'"
          );
          return;
        }

        registerFormEl.addEventListener("submit", async (e) => {
          e.preventDefault();

          const cedula = document.getElementById("cedula").value.trim();
          const nombres = document.getElementById("nombres").value.trim();
          const apellidos = document.getElementById("apellidos").value.trim();
          const correo = document.getElementById("register-email").value.trim();
          const contraseña = document
            .getElementById("register-password")
            .value.trim();
          const telefono = document.getElementById("telefono").value.trim();
          const direccion = document.getElementById("direccion").value.trim();

          if (!correo || !contraseña) {
            alert("Correo y contraseña obligatorios");
            return;
          }

          const [p_nombre, ...restN] = nombres.split(" ");
          const s_nombre = restN.join(" ") || "";
          const [p_apellido, ...restA] = apellidos.split(" ");
          const s_apellido = restA.join(" ") || "";

          const payload = {
            cedula,
            p_nombre: p_nombre || "",
            s_nombre,
            p_apellido: p_apellido || "",
            s_apellido,
            correo,
            contraseña,
            telefono,
            direccion,
          };

          try {
            const res = await fetch("https://reserva-vuelos-backend.onrender.com/register", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(payload),
            });

            const data = await res.json();

            if (res.ok) {
              alert(
                "✅ Registro exitoso: " + (data.message || "Usuario creado")
              );
              registerFormEl.reset();
              registerForm.classList.add("hidden");
              loginForm.classList.remove("hidden");
            } else {
              alert("⚠️ Error: " + (data.message || JSON.stringify(data)));
            }
          } catch (err) {
            console.error("Error fetch:", err);
            alert("❌ No se pudo conectar al servidor.");
          }
        });

        // LOGIN
        const loginFormEl = document.getElementById("loginFormEl");
        if (loginFormEl) {
          loginFormEl.addEventListener("submit", async (e) => {
            e.preventDefault();

            const correo = document.getElementById("login-email").value.trim();
            const contraseña = document
              .getElementById("login-password")
              .value.trim();

            if (!correo || !contraseña) {
              return alert("Por favor, ingresa correo y contraseña.");
            }

            try {
              const res = await fetch("https://reserva-vuelos-backend.onrender.com/login", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ correo, contraseña }),
              });

              const data = await res.json();

              if (res.ok) {
                localStorage.setItem("currentUser", JSON.stringify(data));
                window.location.href = "../../index.html";
              } else {
                alert("Error: " + data.message);
              }
            } catch (err) {
              console.error("Error en login:", err);
              alert("❌ No se pudo conectar al servidor para iniciar sesión.");
            }
          });
        }

        // RECUPERAR CONTRASEÑA
        if (forgotPasswordLink) {
          forgotPasswordLink.addEventListener("click", (e) => {
            e.preventDefault();
            forgotPasswordModal.classList.remove("hidden");
          });
        }

        if (closeModalButton) {
          closeModalButton.addEventListener("click", () => {
            forgotPasswordModal.classList.add("hidden");
          });
        }

        if (forgotPasswordModal) {
          forgotPasswordModal.addEventListener("click", (e) => {
            if (e.target === forgotPasswordModal) {
              forgotPasswordModal.classList.add("hidden");
            }
          });
        }

        if (forgotPasswordForm) {
          forgotPasswordForm.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document
              .getElementById("recovery-email")
              .value.trim();

            if (!email) {
              alert("⚠️ Por favor, ingresa tu correo electrónico.");
              return;
            }

            try {
              const res = await fetch("https://reserva-vuelos-backend.onrender.com/recuperar-cuenta", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ correo: email }),
              });

              const data = await res.json();

              if (res.ok) {
                alert(
                  `✅ Se han enviado las instrucciones de recuperación a: ${email}`
                );
                forgotPasswordModal.classList.add("hidden");
                forgotPasswordForm.reset();
              } else {
                alert(`⚠️ ${data.message || "No se pudo enviar el correo"}`);
              }
            } catch (err) {
              console.error("Error al enviar correo de recuperación:", err);
              alert("❌ No se pudo conectar al servidor. Intenta nuevamente.");
            }
          });
        }
      });
    </script>

    <!-- SCRIPT COMPARTIDO DEL HOME (mostrar/ocultar Mis Reservas, login/user-menu, etc.) -->
    <script>
      (function () {
        let user = null;
        try {
          const raw = localStorage.getItem("currentUser");
          if (raw) user = JSON.parse(raw);
        } catch (e) {}

        const navMisReservas = document.getElementById("nav-mis-reservas");
        const footerMisReservas = document.getElementById("footer-mis-reservas");
        const loginBtn = document.getElementById("login-button");
        const userMenu = document.getElementById("user-menu");

        if (user && user.id_usuario) {
          // usuario autenticado
          if (navMisReservas) navMisReservas.classList.remove("hidden");
          if (footerMisReservas) footerMisReservas.classList.remove("hidden");

          if (loginBtn) loginBtn.classList.add("hidden");
          if (userMenu) userMenu.classList.remove("hidden");
        } else {
          // usuario NO autenticado
          if (navMisReservas) navMisReservas.classList.add("hidden");
          if (footerMisReservas) footerMisReservas.classList.add("hidden");

          if (loginBtn) loginBtn.classList.remove("hidden");
          if (userMenu) userMenu.classList.add("hidden");
        }
      })();
    </script>
  </body>
</html>
